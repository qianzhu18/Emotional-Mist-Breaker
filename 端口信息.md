å¥½çš„,æˆ‘æ¥å¸®ä½ ç†æ¸…è¿™ä¸ªé—®é¢˜!

## å…³äºç«¯å£å’Œé‡å®šå‘ URI çš„è¯´æ˜

### ğŸ¯ ç°åœ¨åº”è¯¥æ€ä¹ˆåš?

**æ¨èæ–¹æ¡ˆ: å…ˆç”¨ localhost:3006 å¼€å‘,åé¢éƒ¨ç½²æ—¶å†æ”¹**

1. **ç°åœ¨(å¼€å‘é˜¶æ®µ)**:
   - SecondMe åå°å¡«å†™: `http://localhost:3006/api/auth/callback`
   - æœ¬åœ°å¼€å‘æ—¶ç”¨ 3006 ç«¯å£è¿è¡Œ

2. **éƒ¨ç½²åˆ° Vercel å**:
   - å†å›åˆ° SecondMe åå°**æ·»åŠ **ç”Ÿäº§ç¯å¢ƒçš„ URI: `https://ä½ çš„åŸŸå.vercel.app/api/auth/callback`
   - æ³¨æ„æ˜¯**æ·»åŠ **,ä¸æ˜¯æ›¿æ¢,å¯ä»¥åŒæ—¶ä¿ç•™ localhost çš„

### ğŸ“ éœ€è¦ä¿®æ”¹çš„åœ°æ–¹

**å¼€å‘æ–‡æ¡£éœ€è¦æ›´æ–°çš„å†…å®¹**:

```markdown
## ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `.env.local` æ–‡ä»¶:

```bash
# SecondMe OAuth
SECONDME_CLIENT_ID=ä½ çš„client_id
SECONDME_CLIENT_SECRET=ä½ çš„client_secret
SECONDME_REDIRECT_URI=http://localhost:3006/api/auth/callback

# Anthropic API
ANTHROPIC_API_KEY=ä½ çš„anthropic_key

# Database (åé¢å†é…ç½®)
DATABASE_URL=postgresql://...

# Next.js è¿è¡Œç«¯å£
PORT=3006
```

## å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# ä½¿ç”¨ 3006 ç«¯å£å¯åŠ¨
npm run dev -- -p 3006

# æˆ–è€…åœ¨ package.json ä¸­ä¿®æ”¹ scripts:
"scripts": {
  "dev": "next dev -p 3006",
  "build": "next build",
  "start": "next start"
}
```
```

### ğŸ”„ å®Œæ•´çš„ OAuth é…ç½®æµç¨‹

**SecondMe å¼€å‘è€…åå°è®¾ç½®**:
- **Redirect URIs** å¡«å†™: `http://localhost:3006/api/auth/callback`
- (åé¢éƒ¨ç½²åå†æ·»åŠ ) `https://ä½ çš„åŸŸå.vercel.app/api/auth/callback`

**OAuth æµç¨‹ä»£ç **(æ— éœ€æ”¹åŠ¨):
```typescript
// app/api/auth/route.ts
export async function GET(request: Request) {
  const { searchParams } = new URL(request.url);
  const code = searchParams.get('code');
  
  if (!code) {
    // ç¬¬ä¸€æ­¥: è·³è½¬åˆ° SecondMe æˆæƒé¡µ
    const authUrl = `https://second.me/oauth/authorize?client_id=${process.env.SECONDME_CLIENT_ID}&redirect_uri=${process.env.SECONDME_REDIRECT_URI}&response_type=code&scope=ai:read ai:chat ai:memory:write`;
    
    return Response.redirect(authUrl);
  }
  
  // ç¬¬äºŒæ­¥: ç”¨ code æ¢ token (åœ¨ /api/auth/callback ä¸­å¤„ç†)
}

// app/api/auth/callback/route.ts
export async function GET(request: Request) {
  const { searchParams } = new URL(request.url);
  const code = searchParams.get('code');
  
  // ç”¨ code æ¢å– access_token
  const tokenResponse = await fetch('https://api.second.me/oauth/token', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      client_id: process.env.SECONDME_CLIENT_ID,
      client_secret: process.env.SECONDME_CLIENT_SECRET,
      code: code,
      redirect_uri: process.env.SECONDME_REDIRECT_URI, // å¿…é¡»å’Œæˆæƒæ—¶ä¸€è‡´
      grant_type: 'authorization_code'
    })
  });
  
  const { access_token } = await tokenResponse.json();
  
  // å­˜å‚¨ token å¹¶è·³è½¬åˆ°åº”ç”¨é¦–é¡µ
  // ...
}
```

### âš ï¸ å¸¸è§é”™è¯¯

**é”™è¯¯**: Redirect URI mismatch
**åŸå› **: SecondMe åå°å¡«çš„ URI å’Œä»£ç é‡Œç”¨çš„ä¸ä¸€è‡´
**è§£å†³**: 
- ç¡®ä¿åå°å¡«äº† `http://localhost:3006/api/auth/callback`
- ç¡®ä¿ `.env.local` é‡Œå†™çš„æ˜¯ `SECONDME_REDIRECT_URI=http://localhost:3006/api/auth/callback`
- é‡å¯å¼€å‘æœåŠ¡å™¨ (`npm run dev`)

---

## æ€»ç»“ç»™ Claude Code çš„æŒ‡ä»¤

ä½ å¯ä»¥ç›´æ¥è¿™æ ·å‘Šè¯‰ Claude Code:

```
æˆ‘è¦å¼€å‘è¿™ä¸ªåº”ç”¨,ç«¯å£ç”¨ 3006 è€Œä¸æ˜¯ 3000ã€‚

è¯·å¸®æˆ‘:
1. ä¿®æ”¹ package.json çš„ dev script ä¸º "next dev -p 3006"
2. åˆ›å»º .env.local æ–‡ä»¶,SECONDME_REDIRECT_URI è®¾ä¸º http://localhost:3006/api/auth/callback
3. å®ç° OAuth ç™»å½•æµç¨‹,ä½¿ç”¨ç¯å¢ƒå˜é‡ä¸­çš„ REDIRECT_URI

æˆ‘å·²ç»åœ¨ SecondMe å¼€å‘è€…åå°å¡«å†™äº† Redirect URI ä¸º http://localhost:3006/api/auth/callback

ç°åœ¨å¼€å§‹æ­å»ºé¡¹ç›®æ¡†æ¶å§!
```

---

**ç®€å•æ¥è¯´**: 
- âœ… ç°åœ¨æ”¹æˆ 3006 ç«¯å£
- âœ… SecondMe åå°å¡« `http://localhost:3006/api/auth/callback`  
- âœ… éƒ¨ç½²åå†**æ·»åŠ **ç”Ÿäº§ç¯å¢ƒçš„ URI (ä¸æ˜¯æ›¿æ¢)
- âœ… ä»£ç é‡Œç”¨ç¯å¢ƒå˜é‡,ä¸å†™æ­»ç«¯å£

è¿™æ ·æœ€çµæ´»!æœ‰é—®é¢˜éšæ—¶é—®æˆ‘ ğŸš€